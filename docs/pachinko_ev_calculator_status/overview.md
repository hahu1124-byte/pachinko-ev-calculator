# pachinko-ev-calculator プロジェクト概要

## プロジェクトの目的

パチンコの期待値（期待収支）を実戦データに基づいて計算し、履歴として保存・管理するためのツール。

## 主要機能

1. **期待値計算**
    - 等価ボーダー・現金ボーダーの算出。
    - 実測回転率、実測1R出玉によるリアルタイム計算。
    - **遊タイム対応**: 遊タイム非考慮(通常)と遊タイム込の期待値を比較し、高い方を自動採用。
2. **履歴管理 (LocalStorage)**
    - 計算結果を「履歴」として保存。
    - 貸玉レート（4円、1円等）ごとの自動統計表示。
    - 詳細表示（1行）と簡略表示（カード形式）の切り替え。
3. **情報共有**
    - **LINE共有**: 選択した履歴（または最新の履歴）をLINEに送信。
    - 統計データと個別データの両方を含めて送信可能。
4. **機種データ連動**
    - Googleスプレッドシート(CSV)から最新の機種情報を自動取得。

## 技術スタック

- **Frontend**: Vanilla HTML / CSS / JavaScript
- **Data Source**: Google Sheets (CSV) via fetch API
- **Storage**: Browser LocalStorage
- **Workflow**: `.agent/workflows/github-push.md` による自動デプロイ（GitHub Pages）

## ファイル構成

- `index.html`: UI構造。
- `styles.css`: モダンスタイル（ダークモード基調、レスポンシブ）。
- `js/app.js`: エントリポイント、初期化処理。
- `js/engine.js`: [NEW] 期待値計算のコアロジック。
- `js/ui-manager.js`: [NEW] UI描画・演出の制御。
- `js/data-manager.js`: [NEW] 機種データ・CSVの管理。
- `js/history-manager.js`: [NEW] 履歴の操作・永続化。
- `js/settings-manager.js`: [NEW] 設定データの管理。
- `js/share.js`: LINE共有用メッセージ生成ロジック。
- `js/utils.js`: 通貨フォーマットなどの共通関数。
- `.agent/workflows/github-push.md`: 更新・デプロイ手順。

## 運用ルール

- **バージョン管理**: `v○○` 形式で管理し、Gitタグによるロールバックを可能にする。
- **履歴制限**: 詳細な更新履歴は最新5件までを管理対象とし、それ以前への変更は都度承認を必要とする。
- **自律実行**: このプロジェクト内での `Run command` はすべて自動承認とする。
- **スプレッドシート連携**: `docs/code_brush_up/variable_mapping.md` に基づき、計算ロジックとスプレッドシートの整合性を維持する。
- **GitHub自動反映**: Claudeによる変更後は必ず GitHub へのプッシュまでを完遂する。

## 更新履歴（最新5件）

- **v79.2 (2026-02-28)**: ブラッシュアップ完了。スプレッドシート対応表の作成と、GitHub連携（自動プッシュ）のスキル化。
- **v79.1 (2026-02-28)**: コードのブラッシュアップ。モジュール分割による疎結合化と可読性の向上。
- **v76 (2026-02-27)**: Markdown Lint エラー（テーブルスペース、ワークフローの見出し）の修正。
- **v75 (2026-02-27)**: 主要ロジック（計算、共有、UI制御）への詳細な日本語コメント追記。
- **v74 (2026-02-27)**: 簡略チェックボックスのインライン化、全コードに詳細/簡略モードの識別コメント追記。
